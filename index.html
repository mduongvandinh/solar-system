<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Solar System - Educational 3D Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        /* Control Panel */
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #4a9eff;
            min-width: 280px;
            backdrop-filter: blur(10px);
        }
        #controls h2 {
            margin-bottom: 15px;
            color: #4a9eff;
            font-size: 18px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #aaa;
        }
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            width: 100%;
            margin-bottom: 8px;
        }
        button:hover {
            background: #3a7ec9;
        }
        button.active {
            background: #2ecc71;
        }
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #4a9eff;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }
        input[type="range"] {
            cursor: pointer;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        /* Info Panel */
        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #4a9eff;
            min-width: 320px;
            max-width: 400px;
            display: none;
            backdrop-filter: blur(10px);
        }
        #info-panel.visible {
            display: block;
        }
        #info-panel h3 {
            color: #4a9eff;
            margin-bottom: 15px;
            font-size: 24px;
        }
        .info-item {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        .info-item strong {
            color: #4a9eff;
        }
        .fun-fact {
            background: rgba(74, 158, 255, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-style: italic;
        }
        #close-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }
        /* Speed Display */
        #speed-display {
            text-align: center;
            font-size: 12px;
            color: #aaa;
            margin-top: 5px;
        }
        /* Planet Labels */
        .planet-label {
            position: absolute;
            color: white;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 8px;
            border-radius: 4px;
            pointer-events: none;
            display: none;
            border: 1px solid #4a9eff;
        }
        .planet-label.visible {
            display: block;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <!-- Control Panel -->
    <div id="controls">
        <h2>Solar System Controls</h2>

        <div class="control-group">
            <button id="play-pause">⏸ Pause</button>
        </div>

        <div class="control-group">
            <label>Speed: <span id="speed-value">1x</span></label>
            <input type="range" id="speed-slider" min="0" max="100" value="10" step="1">
            <div id="speed-display">Normal Speed</div>
        </div>

        <div class="control-group">
            <label>Select Planet:</label>
            <select id="planet-select">
                <option value="">Free View</option>
                <option value="mercury">Mercury</option>
                <option value="venus">Venus</option>
                <option value="earth">Earth</option>
                <option value="mars">Mars</option>
                <option value="jupiter">Jupiter</option>
                <option value="saturn">Saturn</option>
                <option value="uranus">Uranus</option>
                <option value="neptune">Neptune</option>
            </select>
        </div>

        <div class="control-group">
            <label>Preset Views:</label>
            <button id="view-full">Full System</button>
            <button id="view-inner">Inner Planets</button>
            <button id="view-outer">Outer Planets</button>
        </div>

        <div class="control-group">
            <div class="checkbox-group">
                <input type="checkbox" id="toggle-labels" checked>
                <label for="toggle-labels">Show Labels</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="toggle-orbits" checked>
                <label for="toggle-orbits">Show Orbits</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="toggle-asteroids" checked>
                <label for="toggle-asteroids">Show Asteroids</label>
            </div>
        </div>

        <div class="control-group">
            <button id="reset-view">↺ Reset View</button>
            <button id="zoom-out" style="display:none; background:#e67e22;">⇱ Zoom Out</button>
        </div>
    </div>

    <!-- Info Panel -->
    <div id="info-panel">
        <div id="close-info">✕</div>
        <div id="info-content"></div>
    </div>

    <!-- Planet Labels -->
    <div id="labels-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ==================== CONFIGURATION ====================
        const PLANET_DATA = {
            sun: {
                name: 'Sun', radius: 15, color: 0xfdb813, emissive: 0xfdb813,
                info: {
                    diameter: '1,392,700 km',
                    mass: '1.989 × 10³⁰ kg',
                    distance: 'Center of Solar System',
                    rotation: '25-35 days (differential)',
                    moons: '0',
                    atmosphere: 'Hydrogen (73%), Helium (25%)',
                    fact: 'The Sun contains 99.86% of the mass in the Solar System and could fit 1.3 million Earths inside it!'
                }
            },
            mercury: {
                name: 'Mercury', radius: 1.2, color: 0x8c7853, distance: 25, speed: 0.024, rotation: 0.004,
                info: {
                    diameter: '4,879 km',
                    mass: '3.285 × 10²³ kg',
                    distance: '57.9 million km from Sun',
                    orbital: '88 Earth days',
                    rotation: '59 Earth days',
                    moons: '0',
                    atmosphere: 'Trace amounts (negligible)',
                    fact: 'Mercury has the most eccentric orbit and experiences the greatest temperature swings in the solar system, from -180°C to 430°C!'
                }
            },
            venus: {
                name: 'Venus', radius: 2.4, color: 0xffc649, distance: 35, speed: 0.015, rotation: -0.001,
                info: {
                    diameter: '12,104 km',
                    mass: '4.867 × 10²⁴ kg',
                    distance: '108.2 million km from Sun',
                    orbital: '225 Earth days',
                    rotation: '243 Earth days (retrograde)',
                    moons: '0',
                    atmosphere: 'CO₂ (96%), Nitrogen (3.5%)',
                    fact: 'Venus rotates backwards and has days longer than its years! It\'s the hottest planet due to runaway greenhouse effect.'
                }
            },
            earth: {
                name: 'Earth', radius: 2.5, color: 0x4a9eff, distance: 45, speed: 0.01, rotation: 0.02,
                info: {
                    diameter: '12,742 km',
                    mass: '5.972 × 10²⁴ kg',
                    distance: '149.6 million km from Sun',
                    orbital: '365.25 days',
                    rotation: '24 hours',
                    moons: '1 (The Moon)',
                    atmosphere: 'Nitrogen (78%), Oxygen (21%)',
                    fact: 'Earth is the only known planet with liquid water on its surface and the only one confirmed to harbor life!'
                }
            },
            mars: {
                name: 'Mars', radius: 1.3, color: 0xdc4c3c, distance: 58, speed: 0.008, rotation: 0.018,
                info: {
                    diameter: '6,779 km',
                    mass: '6.39 × 10²³ kg',
                    distance: '227.9 million km from Sun',
                    orbital: '687 Earth days',
                    rotation: '24.6 hours',
                    moons: '2 (Phobos, Deimos)',
                    atmosphere: 'CO₂ (95%), Nitrogen (3%)',
                    fact: 'Mars has the largest volcano in the solar system (Olympus Mons) and a canyon system that would stretch across the USA!'
                }
            },
            jupiter: {
                name: 'Jupiter', radius: 11, color: 0xc88b3a, distance: 95, speed: 0.004, rotation: 0.04,
                info: {
                    diameter: '139,820 km',
                    mass: '1.898 × 10²⁷ kg',
                    distance: '778.5 million km from Sun',
                    orbital: '11.86 Earth years',
                    rotation: '9.9 hours',
                    moons: '95+ known moons',
                    atmosphere: 'Hydrogen (90%), Helium (10%)',
                    fact: 'Jupiter is so massive it could contain all other planets combined! Its Great Red Spot is a storm larger than Earth that has raged for 400+ years.'
                }
            },
            saturn: {
                name: 'Saturn', radius: 9, color: 0xfad5a5, distance: 130, speed: 0.003, rotation: 0.038,
                info: {
                    diameter: '116,460 km',
                    mass: '5.683 × 10²⁶ kg',
                    distance: '1.43 billion km from Sun',
                    orbital: '29.46 Earth years',
                    rotation: '10.7 hours',
                    moons: '146+ known moons',
                    atmosphere: 'Hydrogen (96%), Helium (3%)',
                    fact: 'Saturn\'s rings are made of billions of ice particles. Despite its size, Saturn is less dense than water—it would float in a giant bathtub!'
                }
            },
            uranus: {
                name: 'Uranus', radius: 4, color: 0x4fd0e7, distance: 165, speed: 0.002, rotation: 0.03,
                info: {
                    diameter: '50,724 km',
                    mass: '8.681 × 10²⁵ kg',
                    distance: '2.87 billion km from Sun',
                    orbital: '84 Earth years',
                    rotation: '17.2 hours',
                    moons: '27+ known moons',
                    atmosphere: 'Hydrogen (83%), Helium (15%), Methane (2%)',
                    fact: 'Uranus rotates on its side (98° tilt) and has the coldest atmosphere in the solar system at -224°C. It likely was knocked over by a massive collision!'
                }
            },
            neptune: {
                name: 'Neptune', radius: 3.8, color: 0x4166f5, distance: 195, speed: 0.001, rotation: 0.032,
                info: {
                    diameter: '49,244 km',
                    mass: '1.024 × 10²⁶ kg',
                    distance: '4.5 billion km from Sun',
                    orbital: '164.8 Earth years',
                    rotation: '16.1 hours',
                    moons: '14+ known moons',
                    atmosphere: 'Hydrogen (80%), Helium (19%), Methane (1%)',
                    fact: 'Neptune has the fastest winds in the solar system, reaching 2,100 km/h! It was the first planet discovered through mathematical prediction rather than observation.'
                }
            }
        };

        // ==================== SCENE SETUP ====================
        let scene, camera, renderer, controls;
        let celestialBodies = {};
        let orbitLines = {};
        let asteroidBelt;
        let moon;
        let animationId;

        // State
        let isPaused = false;
        let timeSpeed = 1;
        let followingPlanet = null;
        let showLabels = true;
        let showOrbits = true;
        let showAsteroids = true;

        // Camera animation state
        let isAnimatingCamera = false;
        let animationStartTime = 0;
        let animationDuration = 1500; // 1.5 seconds
        let cameraStartPos = { x: 0, y: 0, z: 0 };
        let cameraEndPos = { x: 0, y: 0, z: 0 };
        let cameraStartTarget = { x: 0, y: 0, z: 0 };
        let cameraEndTarget = { x: 0, y: 0, z: 0 };
        let zoomedPlanet = null;
        let previousCameraState = null;

        function init() {
            // Scene
            scene = new THREE.Scene();

            // Camera
            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                0.1,
                5000
            );
            camera.position.set(0, 100, 200);
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Lighting - Sun as point light
            const sunLight = new THREE.PointLight(0xffffff, 2, 1000);
            sunLight.position.set(0, 0, 0);
            scene.add(sunLight);

            const ambientLight = new THREE.AmbientLight(0x222222);
            scene.add(ambientLight);

            // Starfield background
            createStarfield();

            // Create celestial bodies
            createSun();
            createPlanets();
            createMoon();
            createAsteroidBelt();

            // Mouse controls
            setupMouseControls();

            // UI Event listeners
            setupUIControls();

            // Handle resize
            window.addEventListener('resize', onWindowResize);

            // Start animation
            animate();
        }

        // ==================== PROCEDURAL TEXTURES ====================
        function createPlanetTexture(color, type) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');

            // Base color
            ctx.fillStyle = '#' + color.toString(16).padStart(6, '0');
            ctx.fillRect(0, 0, 512, 512);

            // Add variation based on planet type
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * 512;
                const y = Math.random() * 512;
                const radius = Math.random() * 40 + 10;
                const opacity = Math.random() * 0.3;

                const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
                gradient.addColorStop(0, `rgba(0, 0, 0, ${opacity})`);
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');

                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 512, 512);
            }

            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 1.5,
                sizeAttenuation: true
            });

            const starsVertices = [];
            for (let i = 0; i < 3000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }

            starsGeometry.setAttribute('position',
                new THREE.Float32BufferAttribute(starsVertices, 3));

            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
        }

        // ==================== CELESTIAL BODIES ====================
        function createSun() {
            const data = PLANET_DATA.sun;
            const geometry = new THREE.SphereGeometry(data.radius, 32, 32);
            const material = new THREE.MeshBasicMaterial({
                color: data.color,
                emissive: data.emissive,
                emissiveIntensity: 1
            });

            const sun = new THREE.Mesh(geometry, material);
            sun.userData = { name: 'sun', info: data.info };
            scene.add(sun);
            celestialBodies.sun = sun;

            // Sun glow
            const glowGeometry = new THREE.SphereGeometry(data.radius * 1.3, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xfdb813,
                transparent: true,
                opacity: 0.3
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            sun.add(glow);
        }

        function createPlanets() {
            Object.keys(PLANET_DATA).forEach(key => {
                if (key === 'sun') return;

                const data = PLANET_DATA[key];

                // Create planet
                const geometry = new THREE.SphereGeometry(data.radius, 32, 32);
                const texture = createPlanetTexture(data.color, key);
                const material = new THREE.MeshStandardMaterial({
                    map: texture,
                    metalness: 0.3,
                    roughness: 0.7
                });

                const planet = new THREE.Mesh(geometry, material);
                planet.userData = {
                    name: key,
                    distance: data.distance,
                    speed: data.speed,
                    rotation: data.rotation,
                    angle: Math.random() * Math.PI * 2,
                    info: data.info
                };

                scene.add(planet);
                celestialBodies[key] = planet;

                // Create orbit line
                createOrbitLine(data.distance, key);

                // Saturn's rings
                if (key === 'saturn') {
                    createSaturnRings(planet, data.radius);
                }
            });
        }

        function createOrbitLine(distance, planetName) {
            const points = [];
            const segments = 128;

            for (let i = 0; i <= segments; i++) {
                const angle = (i / segments) * Math.PI * 2;
                const x = Math.cos(angle) * distance;
                const z = Math.sin(angle) * distance;
                points.push(new THREE.Vector3(x, 0, z));
            }

            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const material = new THREE.LineBasicMaterial({
                color: 0x4a9eff,
                transparent: true,
                opacity: 0.3
            });

            const orbit = new THREE.Line(geometry, material);
            scene.add(orbit);
            orbitLines[planetName] = orbit;
        }

        function createSaturnRings(planet, planetRadius) {
            const ringGeometry = new THREE.RingGeometry(
                planetRadius * 1.2,
                planetRadius * 2,
                64
            );
            const ringMaterial = new THREE.MeshBasicMaterial({
                color: 0xc9a876,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.7
            });

            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.rotation.x = Math.PI / 2;
            planet.add(ring);
        }

        function createMoon() {
            const geometry = new THREE.SphereGeometry(0.4, 16, 16);
            const material = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });
            moon = new THREE.Mesh(geometry, material);
            moon.userData = {
                distance: 5,
                speed: 0.08,
                angle: 0
            };
            scene.add(moon);
        }

        function createAsteroidBelt() {
            const asteroidGroup = new THREE.Group();
            const asteroidCount = 800;

            for (let i = 0; i < asteroidCount; i++) {
                const size = Math.random() * 0.3 + 0.1;
                const geometry = new THREE.SphereGeometry(size, 6, 6);
                const material = new THREE.MeshStandardMaterial({ color: 0x8B7355 });
                const asteroid = new THREE.Mesh(geometry, material);

                const distance = 70 + Math.random() * 15;
                const angle = Math.random() * Math.PI * 2;
                const x = Math.cos(angle) * distance;
                const z = Math.sin(angle) * distance;
                const y = (Math.random() - 0.5) * 2;

                asteroid.position.set(x, y, z);
                asteroidGroup.add(asteroid);
            }

            scene.add(asteroidGroup);
            asteroidBelt = asteroidGroup;
        }

        // ==================== ANIMATION ====================
        function animate() {
            animationId = requestAnimationFrame(animate);

            if (!isPaused) {
                updatePlanets();
                updateMoon();
            }

            updateCamera();
            updateLabels();

            renderer.render(scene, camera);
        }

        function updatePlanets() {
            Object.keys(celestialBodies).forEach(key => {
                if (key === 'sun') return;

                const planet = celestialBodies[key];
                const data = planet.userData;

                // Update orbital position (elliptical approximation)
                data.angle += data.speed * timeSpeed;
                const x = Math.cos(data.angle) * data.distance;
                const z = Math.sin(data.angle) * data.distance * 0.95; // Slight ellipse
                planet.position.set(x, 0, z);

                // Update rotation
                planet.rotation.y += data.rotation * timeSpeed;
            });
        }

        function updateMoon() {
            if (!celestialBodies.earth) return;

            const earth = celestialBodies.earth;
            const data = moon.userData;

            data.angle += data.speed * timeSpeed;
            const x = earth.position.x + Math.cos(data.angle) * data.distance;
            const z = earth.position.z + Math.sin(data.angle) * data.distance;
            moon.position.set(x, earth.position.y, z);
        }

        // ==================== CAMERA CONTROLS ====================
        let mouseDown = false;
        let mouseX = 0;
        let mouseY = 0;
        let cameraAngle = 0;
        let cameraHeight = 100;
        let cameraDistance = 200;

        function setupMouseControls() {
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('wheel', onWheel);
            renderer.domElement.addEventListener('click', onCanvasClick);
        }

        function onMouseDown(e) {
            mouseDown = true;
            mouseX = e.clientX;
            mouseY = e.clientY;
        }

        function onMouseMove(e) {
            if (!mouseDown || followingPlanet) return;

            const deltaX = e.clientX - mouseX;
            const deltaY = e.clientY - mouseY;

            cameraAngle += deltaX * 0.005;
            cameraHeight += deltaY * 0.5;
            cameraHeight = Math.max(-200, Math.min(300, cameraHeight));

            mouseX = e.clientX;
            mouseY = e.clientY;
        }

        function onMouseUp() {
            mouseDown = false;
        }

        function onWheel(e) {
            e.preventDefault();
            cameraDistance += e.deltaY * 0.1;
            cameraDistance = Math.max(30, Math.min(500, cameraDistance));
        }

        function updateCamera() {
            // Handle smooth camera animation
            if (isAnimatingCamera) {
                const now = Date.now();
                const elapsed = now - animationStartTime;
                const progress = Math.min(elapsed / animationDuration, 1);

                // Ease in-out function for smooth animation
                const easeProgress = progress < 0.5
                    ? 2 * progress * progress
                    : 1 - Math.pow(-2 * progress + 2, 2) / 2;

                // Interpolate position
                camera.position.x = cameraStartPos.x + (cameraEndPos.x - cameraStartPos.x) * easeProgress;
                camera.position.y = cameraStartPos.y + (cameraEndPos.y - cameraStartPos.y) * easeProgress;
                camera.position.z = cameraStartPos.z + (cameraEndPos.z - cameraStartPos.z) * easeProgress;

                // Interpolate look-at target
                const targetX = cameraStartTarget.x + (cameraEndTarget.x - cameraStartTarget.x) * easeProgress;
                const targetY = cameraStartTarget.y + (cameraEndTarget.y - cameraStartTarget.y) * easeProgress;
                const targetZ = cameraStartTarget.z + (cameraEndTarget.z - cameraStartTarget.z) * easeProgress;
                camera.lookAt(targetX, targetY, targetZ);

                // Animation complete
                if (progress >= 1) {
                    isAnimatingCamera = false;
                }
                return;
            }

            if (followingPlanet && celestialBodies[followingPlanet]) {
                const planet = celestialBodies[followingPlanet];
                const offset = 20;
                camera.position.set(
                    planet.position.x + offset,
                    planet.position.y + offset * 0.5,
                    planet.position.z + offset
                );
                camera.lookAt(planet.position);
            } else if (zoomedPlanet && celestialBodies[zoomedPlanet]) {
                // Keep camera focused on zoomed planet
                const planet = celestialBodies[zoomedPlanet];
                camera.lookAt(planet.position);
            } else {
                camera.position.x = Math.cos(cameraAngle) * cameraDistance;
                camera.position.y = cameraHeight;
                camera.position.z = Math.sin(cameraAngle) * cameraDistance;
                camera.lookAt(0, 0, 0);
            }
        }

        // Smooth zoom to planet
        function zoomToPlanet(planetName) {
            const planet = celestialBodies[planetName];
            if (!planet) return;

            // Save previous camera state
            if (!zoomedPlanet) {
                previousCameraState = {
                    distance: cameraDistance,
                    height: cameraHeight,
                    angle: cameraAngle
                };
            }

            // Calculate zoom distance based on planet size
            const planetRadius = PLANET_DATA[planetName].radius;
            const zoomDistance = planetRadius * 3.5;

            // Start animation
            isAnimatingCamera = true;
            animationStartTime = Date.now();

            // Store start position
            cameraStartPos = {
                x: camera.position.x,
                y: camera.position.y,
                z: camera.position.z
            };

            // Calculate end position (position relative to planet)
            const angleOffset = 0.5;
            cameraEndPos = {
                x: planet.position.x + Math.cos(angleOffset) * zoomDistance,
                y: planet.position.y + zoomDistance * 0.4,
                z: planet.position.z + Math.sin(angleOffset) * zoomDistance
            };

            // Store look-at targets
            const currentTarget = new THREE.Vector3();
            camera.getWorldDirection(currentTarget);
            currentTarget.multiplyScalar(100).add(camera.position);

            cameraStartTarget = {
                x: currentTarget.x,
                y: currentTarget.y,
                z: currentTarget.z
            };

            cameraEndTarget = {
                x: planet.position.x,
                y: planet.position.y,
                z: planet.position.z
            };

            zoomedPlanet = planetName;

            // Show zoom out button
            document.getElementById('zoom-out').style.display = 'block';
        }

        // Zoom out to previous view
        function zoomOut() {
            if (!previousCameraState) return;

            isAnimatingCamera = true;
            animationStartTime = Date.now();

            // Store start position
            cameraStartPos = {
                x: camera.position.x,
                y: camera.position.y,
                z: camera.position.z
            };

            // Calculate end position from stored state
            cameraEndPos = {
                x: Math.cos(previousCameraState.angle) * previousCameraState.distance,
                y: previousCameraState.height,
                z: Math.sin(previousCameraState.angle) * previousCameraState.distance
            };

            // Store look-at targets
            if (zoomedPlanet && celestialBodies[zoomedPlanet]) {
                const planet = celestialBodies[zoomedPlanet];
                cameraStartTarget = {
                    x: planet.position.x,
                    y: planet.position.y,
                    z: planet.position.z
                };
            } else {
                cameraStartTarget = {
                    x: camera.position.x,
                    y: camera.position.y,
                    z: camera.position.z
                };
            }

            cameraEndTarget = { x: 0, y: 0, z: 0 };

            // Restore state
            cameraDistance = previousCameraState.distance;
            cameraHeight = previousCameraState.height;
            cameraAngle = previousCameraState.angle;

            zoomedPlanet = null;
            previousCameraState = null;
        }

        function onCanvasClick(e) {
            // Check if click is on UI elements
            if (e.target !== renderer.domElement) return;

            const mouse = new THREE.Vector2(
                (e.clientX / window.innerWidth) * 2 - 1,
                -(e.clientY / window.innerHeight) * 2 + 1
            );

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const objects = Object.values(celestialBodies);
            const intersects = raycaster.intersectObjects(objects);

            if (intersects.length > 0) {
                const clicked = intersects[0].object;
                const planetName = clicked.userData.name;

                // Zoom to planet
                zoomToPlanet(planetName);

                // Show info panel
                showInfoPanel(planetName);
            }
        }

        // ==================== UI CONTROLS ====================
        function setupUIControls() {
            // Play/Pause
            document.getElementById('play-pause').addEventListener('click', () => {
                isPaused = !isPaused;
                document.getElementById('play-pause').textContent = isPaused ? '▶ Play' : '⏸ Pause';
                document.getElementById('play-pause').classList.toggle('active', !isPaused);
            });

            // Speed slider
            const speedSlider = document.getElementById('speed-slider');
            speedSlider.addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                // Logarithmic scale: 0-100 maps to 0.1x - 100x
                if (value === 0) {
                    timeSpeed = 0.1;
                } else {
                    timeSpeed = Math.pow(10, (value / 25) - 1);
                }

                let speedText = timeSpeed.toFixed(1) + 'x';
                let speedDesc = 'Custom Speed';

                if (timeSpeed < 0.5) speedDesc = 'Very Slow';
                else if (timeSpeed < 1) speedDesc = 'Slow';
                else if (timeSpeed === 1) speedDesc = 'Normal Speed';
                else if (timeSpeed < 5) speedDesc = 'Fast';
                else if (timeSpeed < 20) speedDesc = 'Very Fast';
                else speedDesc = 'Extremely Fast';

                document.getElementById('speed-value').textContent = speedText;
                document.getElementById('speed-display').textContent = speedDesc;
            });

            // Planet selection
            document.getElementById('planet-select').addEventListener('change', (e) => {
                followingPlanet = e.target.value || null;
            });

            // View presets
            document.getElementById('view-full').addEventListener('click', () => {
                // Reset zoom state
                zoomedPlanet = null;
                previousCameraState = null;
                isAnimatingCamera = false;

                cameraDistance = 250;
                cameraHeight = 100;
                cameraAngle = 0;
                followingPlanet = null;
                document.getElementById('planet-select').value = '';
                document.getElementById('zoom-out').style.display = 'none';
            });

            document.getElementById('view-inner').addEventListener('click', () => {
                // Reset zoom state
                zoomedPlanet = null;
                previousCameraState = null;
                isAnimatingCamera = false;

                cameraDistance = 80;
                cameraHeight = 40;
                followingPlanet = null;
                document.getElementById('planet-select').value = '';
                document.getElementById('zoom-out').style.display = 'none';
            });

            document.getElementById('view-outer').addEventListener('click', () => {
                // Reset zoom state
                zoomedPlanet = null;
                previousCameraState = null;
                isAnimatingCamera = false;

                cameraDistance = 350;
                cameraHeight = 80;
                followingPlanet = null;
                document.getElementById('planet-select').value = '';
                document.getElementById('zoom-out').style.display = 'none';
            });

            // Toggle controls
            document.getElementById('toggle-labels').addEventListener('change', (e) => {
                showLabels = e.target.checked;
            });

            document.getElementById('toggle-orbits').addEventListener('change', (e) => {
                showOrbits = e.target.checked;
                Object.values(orbitLines).forEach(orbit => {
                    orbit.visible = showOrbits;
                });
            });

            document.getElementById('toggle-asteroids').addEventListener('change', (e) => {
                showAsteroids = e.target.checked;
                if (asteroidBelt) asteroidBelt.visible = showAsteroids;
            });

            // Reset view
            document.getElementById('reset-view').addEventListener('click', () => {
                // Reset zoom state
                zoomedPlanet = null;
                previousCameraState = null;
                isAnimatingCamera = false;

                cameraDistance = 200;
                cameraHeight = 100;
                cameraAngle = 0;
                timeSpeed = 1;
                isPaused = false;
                followingPlanet = null;
                document.getElementById('speed-slider').value = 10;
                document.getElementById('speed-value').textContent = '1.0x';
                document.getElementById('speed-display').textContent = 'Normal Speed';
                document.getElementById('play-pause').textContent = '⏸ Pause';
                document.getElementById('planet-select').value = '';
                document.getElementById('zoom-out').style.display = 'none';
                document.getElementById('info-panel').classList.remove('visible');
            });

            // Close info panel
            document.getElementById('close-info').addEventListener('click', () => {
                document.getElementById('info-panel').classList.remove('visible');
            });

            // Zoom out button
            document.getElementById('zoom-out').addEventListener('click', () => {
                zoomOut();
                document.getElementById('zoom-out').style.display = 'none';
                document.getElementById('info-panel').classList.remove('visible');
            });
        }

        // ==================== LABELS ====================
        function updateLabels() {
            if (!showLabels) {
                document.querySelectorAll('.planet-label').forEach(label => {
                    label.classList.remove('visible');
                });
                return;
            }

            Object.keys(celestialBodies).forEach(key => {
                const body = celestialBodies[key];
                let label = document.getElementById(`label-${key}`);

                if (!label) {
                    label = document.createElement('div');
                    label.id = `label-${key}`;
                    label.className = 'planet-label';
                    label.textContent = PLANET_DATA[key].name;
                    document.getElementById('labels-container').appendChild(label);
                }

                const vector = body.position.clone();
                vector.project(camera);

                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;

                label.style.left = x + 'px';
                label.style.top = (y - 30) + 'px';
                label.classList.add('visible');
            });
        }

        // ==================== INFO PANEL ====================
        function showInfoPanel(planetName) {
            const data = PLANET_DATA[planetName];
            if (!data || !data.info) return;

            const info = data.info;
            const content = `
                <h3>${data.name}</h3>
                <div class="info-item"><strong>Diameter:</strong> ${info.diameter}</div>
                <div class="info-item"><strong>Mass:</strong> ${info.mass}</div>
                <div class="info-item"><strong>Distance from Sun:</strong> ${info.distance}</div>
                ${info.orbital ? `<div class="info-item"><strong>Orbital Period:</strong> ${info.orbital}</div>` : ''}
                <div class="info-item"><strong>Rotation Period:</strong> ${info.rotation}</div>
                <div class="info-item"><strong>Moons:</strong> ${info.moons}</div>
                <div class="info-item"><strong>Atmosphere:</strong> ${info.atmosphere}</div>
                <div class="fun-fact"><strong>Fun Fact:</strong> ${info.fact}</div>
            `;

            document.getElementById('info-content').innerHTML = content;
            document.getElementById('info-panel').classList.add('visible');
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ==================== START ====================
        init();
    </script>
</body>
</html>
